<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" class="light-mode">
    <head>
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=9" />
        <meta name="generator" content="Doxygen 1.9.8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>ampsci:
            Two-valence atoms: CI+MBPT</title>
        <link href="tabs.css" rel="stylesheet" type="text/css" />
        <script type="text/javascript" src="jquery.js"></script>
        <script type="text/javascript" src="dynsections.js"></script>
        <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
        <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
        <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="./MathJax.js"></script>
        <link href="doxygen.css" rel="stylesheet" type="text/css" />
        <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="blue-theme.css" rel="stylesheet" type="text/css"/>
        <!-- ... other metadata & script includes ... -->
        <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
        <script type="text/javascript">
            DoxygenAwesomeFragmentCopyButton.init()
        </script>
        <!-- <script>
            document.documentElement.classList.add("light-mode");
        </script> -->
    </head>
    <body>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div id="titlearea">
                <table cellspacing="0" cellpadding="0">
                    <tbody>
                        <tr style="height: 56px;">
                            <td id="projectalign" style="padding-left: 0.5em;">
                                <div id="projectname">ampsci
                                </div>
                                <div
                                    id="projectbrief">High-precision calculations for one- and two-valence atomic systems</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('tutorial_ci.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Two-valence atoms: CI+MBPT</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>CI+MBPT calculations for two-valence atoms.</p>
<p>This assumes you already have ampsci compiled and have a basic understanding of how to run and use it.</p>
<ul>
<li>See <a class="el" href="compilation.html">Compilation</a> for compilation instructions</li>
<li>See <a class="el" href="tutorial_basic.html">Basic Tutorial</a> for getting started if unfamiliar</li>
<li>See <a href="https://ampsci.dev/ampsci.pdf">ampsci.dev/ampsci.pdf</a> for full description of the physics</li>
</ul>
<h2>Contents</h2>
<ul>
<li><a class="el" href="tutorial_ci.html#cimbpt">CI+MBPT overview</a></li>
<li><a class="el" href="tutorial_ci.html#basic">Basic CI example</a></li>
</ul>
<h2>CI+MBPT overview: Configuration Interaction with Many-Body Perturbation Theory <a class="anchor" id="cimbpt"></a></h2>
<p>For an \(M\)-valence atomic system, the effective Hamiltonian is</p>
<p class="formulaDsp">
\[
    H_{\rm CI} = H_{\rm CI}^1 + H_{\rm CI}^2 =
    \sum_i^M \left(h^{\rm HF}(r_i) + \Sigma^1(r_i)\right)
    +\sum_{i &lt; j}\left(r^{-1}_{ij}
    +\Sigma^2(r_i,r_j)\right),
\]
</p>
<p>where \(h^{\rm HF}\) is one-particle the Hartree-Fock Hamiltonian (with HF potential due to the \(N-M\) core electrons), \(\Sigma^1\) accounts for the core-valence correlations, and \(\Sigma^2\) accounts for the screening of the valence-valence Coulomb interaction by the core electrons.</p>
<p>The CI routines in ampsci are only for two-valence systems: \(M=2\).</p>
<p>In the CI method, approximate valence-space wavefunctions, \(\Psi\), are expanded over \(M\)-particle wavefunctions called Configuration-State Functions (CSFs), \(\psi_I\):</p>
<p class="formulaDsp">
\[
    \left|{\Psi,J^\pi J_z}\right\rangle = \sum_I c_I  \left|{I,J^\pi J_z}\right\rangle.
\]
</p>
<p>The CSFs are combinations of Slater-determinants formed from single-particle eigenfunctions. The CSFs are eigenfunctions of \(J^2\), \(J_z\), and parity ( \(\pi\)). For each \(J^\pi\) symmetry, the energies and wavefunctions (expansion coefficients) are found by solving the Schr"odinger equation, which for a finite set of \(N_{CSF}\) CSFs, is cast to an \(N_{CSF}^2\) eigenvalue problem:</p>
<p class="formulaDsp">
\[
    \sum_J c_J\left\langle{I}\right|H_{\rm eff}\left|{J}\right\rangle = E c_I,
\]
</p>
<p>For the single-particle basis, we use eigenfunctions of the same \(h^{\rm HF}\) Hamiltonian from the CI Hamiltonian. This is known as the \(V^{N-M}\) approximation, with simplifies the MBPT part of the calculation, and is very accurate for two-valence systems.</p>
<hr  />
<h2>Basic CI example <a class="anchor" id="basic"></a></h2>
<p>As always, we check the available input options: <code>./ampsci -i CI</code></p>
<p><code>./ampsci -i CI</code></p>
<div class="fragment"><div class="line"><span class="comment">// Available CI options/blocks</span></div>
<div class="line"><a class="code hl_namespace" href="namespaceCI.html">CI</a>{</div>
<div class="line">  <span class="comment">// Basis used for CI expansion; must be a sub-set of full ampsci basis</span></div>
<div class="line">  <span class="comment">// [default: 10spdf]</span></div>
<div class="line">  ci_basis;</div>
<div class="line">  <span class="comment">// List of total angular momentum J for CI solutions (comma separated). Must</span></div>
<div class="line">  <span class="comment">// be integers (two-electron only). []</span></div>
<div class="line">  J;</div>
<div class="line">  <span class="comment">// As above, but for EVEN CSFs only (takes precedence over J).</span></div>
<div class="line">  J+;</div>
<div class="line">  <span class="comment">// As above, but for ODD CSFs (takes precedence over J).</span></div>
<div class="line">  J-;</div>
<div class="line">  <span class="comment">// Number of CI solutions to find (for each J/pi) [5]</span></div>
<div class="line">  num_solutions;</div>
<div class="line">  <span class="comment">// Include one-body MBPT correlations? [false]</span></div>
<div class="line">  sigma1;</div>
<div class="line">  <span class="comment">// Include two-body MBPT correlations? [false]</span></div>
<div class="line">  sigma2;</div>
<div class="line">  <span class="comment">// The subset of ci_basis for which the two-body MBPT corrections are</span></div>
<div class="line">  <span class="comment">// calculated. Must be a subset of ci_basis. If existing sk file has more</span></div>
<div class="line">  <span class="comment">// integrals, they will be used. [default: Nspdf, where N is maximum n for</span></div>
<div class="line">  <span class="comment">// core + 3]</span></div>
<div class="line">  cis2_basis;</div>
<div class="line">  <span class="comment">// Basis used for the one-body MBPT diagrams (Sigma^1). These are the most</span></div>
<div class="line">  <span class="comment">// important, so in general the default (all basis states) should be used.</span></div>
<div class="line">  <span class="comment">// Must be a subset of full ampsci basis. [default: full basis]</span></div>
<div class="line">  <span class="comment">//  - Note: if CorrelationPotential is available, it will be used instead of</span></div>
<div class="line">  <span class="comment">// calculating the Sigma_1 integrals</span></div>
<div class="line">  s1_basis;</div>
<div class="line">  <span class="comment">// Basis used for internal lines of the two-body MBPT diagrams (Sigma^2). Must</span></div>
<div class="line">  <span class="comment">// be a subset of s1_basis. [default: s1_basis]</span></div>
<div class="line">  s2_basis;</div>
<div class="line">  <span class="comment">// Minimum n for core to be included in MBPT [1]</span></div>
<div class="line">  n_min_core;</div>
<div class="line">  <span class="comment">// Maximum k (multipolarity) to include when calculating new Coulomb</span></div>
<div class="line">  <span class="comment">// integrals. Higher k often contribute negligibly. Note: if qk file already</span></div>
<div class="line">  <span class="comment">// has higher-k terms, they will be included. Set negative (or very large) to</span></div>
<div class="line">  <span class="comment">// include all k. [8]</span></div>
<div class="line">  max_k;</div>
<div class="line">  <span class="comment">// Filename for storing two-body Coulomb integrals. By default, is At.qk,</span></div>
<div class="line">  <span class="comment">// where At is atomic symbol.</span></div>
<div class="line">  qk_file;</div>
<div class="line">  <span class="comment">// Filename for storing two-body Sigma_2 integrals. By default, is</span></div>
<div class="line">  <span class="comment">// At_n_b_k.sk, where At is atomic symbol, n is n_min_core, b is cis2_basis, k</span></div>
<div class="line">  <span class="comment">// is max_k.</span></div>
<div class="line">  sk_file;</div>
<div class="line">  <span class="comment">// Excludes the Sigma_2 box corrections that have &#39;wrong&#39; parity when</span></div>
<div class="line">  <span class="comment">// calculating Sigma2 matrix elements. Note: If existing sk file already has</span></div>
<div class="line">  <span class="comment">// these, they will be included [false]</span></div>
<div class="line">  exclude_wrong_parity_box;</div>
<div class="line">  <span class="comment">// Sort output by energy? Default is to sort by J and Pi first. [false]</span></div>
<div class="line">  sort_output;</div>
<div class="line">  <span class="comment">// Run CI in parallel (solve each J/Pi in parallel). Faster, uses slightly</span></div>
<div class="line">  <span class="comment">// more memory [true]</span></div>
<div class="line">  parallel_ci;</div>
<div class="line">}</div>
<div class="ttc" id="anamespaceCI_html"><div class="ttname"><a href="namespaceCI.html">CI</a></div><div class="ttdoc">Functions and classes for Configuration Interaction calculations.</div><div class="ttdef"><b>Definition</b> CI_Integrals.cpp:11</div></div>
</div><!-- fragment --><p>For a simple example, we'll consider neutral Mg.</p>
<p>The first part of the input file will be familiar from previous examples. We don't need valence states in Hartree-Fock, so, this can be left blank. We don't include the two valence states in the core, hence use \(V^{N-2}\) approximation.</p>
<div class="fragment"><div class="line">Atom {</div>
<div class="line">  Z = Mg;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">HartreeFock {</div>
<div class="line">  core = [Ne];</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">Basis {</div>
<div class="line">  number = 30;</div>
<div class="line">  order = 7;</div>
<div class="line">  r0 = 1.0e-4; </div>
<div class="line">  rmax = 50.0;</div>
<div class="line">  states = 30spdfghi;</div>
<div class="line">}</div>
</div><!-- fragment --><p>To begin the CI calculation</p>
<div class="fragment"><div class="line"><a class="code hl_namespace" href="namespaceCI.html">CI</a>{</div>
<div class="line">  ci_basis = 20spdf;</div>
<div class="line">  J+ = 0,1,2; </div>
<div class="line">  J- = 0,1,2; </div>
<div class="line">  num_solutions = 3;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The <code>ci_basis</code> options means we will use two-particle CSFs formed from combinations of single-particle basis states up to \(n=20\) for \(s\), \(p\), \(d\), and \(f\) states. We will find the lowest 3 solutions for each \(J^\pi\) symmetry up to \(J=2\).</p>
<p>The first part of the output:</p>
<div class="fragment"><div class="line">Using 20spdf = 124 orbitals in CI expansion</div>
<div class="line">Calculate two-body Coulomb integrals: Q^k_abcd</div>
<div class="line">For: 20spdf</div>
<div class="line">fill: T = 4.09 s</div>
<div class="line">Summary: </div>
<div class="line">k=0: 674541 [712697]</div>
<div class="line">k=1: 3221991 [3439651]</div>
<div class="line">k=2: 5519503 [5967347]</div>
<div class="line">k=3: 3943836 [4026031]</div>
<div class="line">k=4: 2017036 [2144977]</div>
<div class="line">k=5: 421821 [444487]</div>
<div class="line">k=6: 97903 [99733]</div>
<div class="line">Total: 15896631 non-zero integrals</div>
<div class="line">Calculated 15896631 new Coulomb integrals</div>
<div class="line">Writing 15896631 integrals to file: Mg2.qk..</div>
</div><!-- fragment --><p>The code pre-computes all the two-body Coulomb integrals \(Q^k_{ijkl}\). This uses a significant memory footprint, but makes the subsequent calculations much faster. It only calculates the required integrals. Even though our total basis was up to <code>30spdfghi</code>, we only used <code>20spdf</code> in the CI expansion (the remaining basis states will be used for MBPT in the next example).</p>
<p>Then, the code runs CI routine for each symmetry. The output for each symmetry will look something like this:</p>
<div class="fragment"><div class="line">Run CI for J=2, even parity</div>
<div class="line">Total CSFs: 3322</div>
<div class="line">Find first 3 solutions</div>
<div class="line">Eigenvalues: T = 6.35 s</div>
<div class="line">2 + 0   -0.61245597 au   -134418.55 cm^-1         0.00 cm^-1</div>
<div class="line">  3s+3d- 24.315%</div>
<div class="line">  3s+4d- 6.641%</div>
<div class="line">  3s+3d+ 36.577%</div>
<div class="line">  3s+4d+ 9.997%</div>
<div class="line">  3p-3p+ 13.492%</div>
<div class="line">  3p+^2  6.672%</div>
<div class="line">  -----</div>
<div class="line">  gJ = 0.999992</div>
<div class="line">  3s3d   1^D_2</div>
<div class="line"> </div>
<div class="line">2 + 1   -0.60402693 au   -132568.59 cm^-1      1849.96 cm^-1</div>
<div class="line">  3s+3d- 36.479%</div>
<div class="line">  3s+4d- 22.333%</div>
<div class="line">  3s+3d+ 24.246%</div>
<div class="line">  3s+4d+ 14.846%</div>
<div class="line">  -----</div>
<div class="line">  gJ = 1.16666</div>
<div class="line">  3s3d   3^D_2</div>
<div class="line"> </div>
<div class="line">2 + 2   -0.58093715 au   -127500.97 cm^-1      6917.58 cm^-1</div>
<div class="line">  3s+4d- 17.604%</div>
<div class="line">  3s+5d- 16.042%</div>
<div class="line">  3s+3d+ 1.168%</div>
<div class="line">  3s+4d+ 26.463%</div>
<div class="line">  3s+5d+ 24.122%</div>
<div class="line">  3p-3p+ 8.217%</div>
<div class="line">  3p+^2  3.988%</div>
<div class="line">  -----</div>
<div class="line">  gJ = 0.999999</div>
<div class="line">  3s4d   1^D_2</div>
</div><!-- fragment --><p>After each line, the code will list all CSFs that contribute to the solution at above the 1% level (i.e., with \(c_I^2&gt;0.01\)). The code also calculates the \(g\)-factor (without RPAd), which are useful for level identification. The term symbol ( \({}^{2S+1}L_J\) e.g., 1^D_2) and leading configuration are given &ndash; the term symbol is 'guessed' based on the g-factor. It is not well defined relativistically, so should be seen as indicative only.</p>
<p>The final output shows a summary of the calculation:</p>
<div class="fragment"><div class="line">J  pi  #  conf.  %   Term   Energy(au)   Energy(/cm)   Level(/cm)  gJ</div>
<div class="line">0  +1  0  3s^2   89  1S    -0.81804187    -179539.44         0.00</div>
<div class="line">0  +1  1  3s4s   66  1S    -0.62364477    -136874.21     42665.23</div>
<div class="line">0  +1  2  3s6s   61  1S    -0.58273524    -127895.60     51643.83</div>
<div class="line">1  +1  0  3s4s   83  3S    -0.63395079    -139136.12     40403.32  2.0000</div>
<div class="line">1  +1  1  3s3d   61  3D    -0.60402720    -132568.65     46970.79  0.5000</div>
<div class="line">1  +1  2  3s5s   47  3S    -0.58579051    -128566.16     50973.28  2.0000</div>
<div class="line">2  +1  0  3s3d   61  1D    -0.61245597    -134418.55     45120.89  1.0000</div>
<div class="line">2  +1  1  3s3d   61  3D    -0.60402693    -132568.59     46970.85  1.1667</div>
<div class="line">2  +1  2  3s4d   44  1D    -0.58093715    -127500.97     52038.47  1.0000</div>
<div class="line">0  -1  0  3s3p   94  3Po   -0.72277949    -158631.76     20907.67</div>
<div class="line">0  -1  1  3s4p   65  3Po   -0.60427214    -132622.40     46917.03</div>
<div class="line">0  -1  2  3s6p   64  3Po   -0.57513793    -126228.19     53311.25</div>
<div class="line">1  -1  0  3s3p   94  3Po   -0.72268645    -158611.34     20928.09  1.5000</div>
<div class="line">1  -1  1  3s3p   71  1Po   -0.66089031    -145048.66     34490.78  1.0000</div>
<div class="line">1  -1  2  3s4p   65  3Po   -0.60425669    -132619.01     46920.42  1.5000</div>
<div class="line">2  -1  0  3s3p   94  3Po   -0.72249992    -158570.40     20969.03  1.5000</div>
<div class="line">2  -1  1  3s4p   65  3Po   -0.60422554    -132612.18     46927.26  1.5000</div>
<div class="line">2  -1  2  3s6p   64  3Po   -0.57511959    -126224.16     53315.28  1.5000</div>
</div><!-- fragment --><p>Where <code>conf</code> is the leading configuration (in non-relativistic notation), and the <code>%</code> column shows the combined constructions from each relativistic configuration with the same non-relativistic configuration (e.g., <code>3s3d</code> may have contributions from <code>3s3d-</code> and <code>3s3d+</code>).</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Level   </th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">AMPSCI   </th><th class="markdownTableHeadNone">Exp.   </th><th class="markdownTableHeadNone">\(\Delta\)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(3s^2\)   </td><td class="markdownTableBodyNone">\({}^1S_0\)   </td><td class="markdownTableBodyNone">-179539   </td><td class="markdownTableBodyNone">-182939   </td><td class="markdownTableBodyNone">-1.9%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(3s4s\)   </td><td class="markdownTableBodyNone">\({}^1S_0\)   </td><td class="markdownTableBodyNone">42665   </td><td class="markdownTableBodyNone">43503   </td><td class="markdownTableBodyNone">-1.9%    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(3s6s\)   </td><td class="markdownTableBodyNone">\({}^1S_0\)   </td><td class="markdownTableBodyNone">51644   </td><td class="markdownTableBodyNone">52556   </td><td class="markdownTableBodyNone">-1.7%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(3s4s\)   </td><td class="markdownTableBodyNone">\({}^3S_1\)   </td><td class="markdownTableBodyNone">40403   </td><td class="markdownTableBodyNone">41197   </td><td class="markdownTableBodyNone">-1.9%    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(3s3d\)   </td><td class="markdownTableBodyNone">\({}^3D_1\)   </td><td class="markdownTableBodyNone">46971   </td><td class="markdownTableBodyNone">47957   </td><td class="markdownTableBodyNone">-2.1%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(3s5s\)   </td><td class="markdownTableBodyNone">\({}^3S_1\)   </td><td class="markdownTableBodyNone">50973   </td><td class="markdownTableBodyNone">51873   </td><td class="markdownTableBodyNone">-1.7%    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(3s3d\)   </td><td class="markdownTableBodyNone">\({}^1D_2\)   </td><td class="markdownTableBodyNone">45121   </td><td class="markdownTableBodyNone">46403   </td><td class="markdownTableBodyNone">-2.8%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(3s3d\)   </td><td class="markdownTableBodyNone">\({}^3D_2\)   </td><td class="markdownTableBodyNone">46971   </td><td class="markdownTableBodyNone">47957   </td><td class="markdownTableBodyNone">-2.1%    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(3s4d\)   </td><td class="markdownTableBodyNone">\({}^1D_2\)   </td><td class="markdownTableBodyNone">52038   </td><td class="markdownTableBodyNone">53135   </td><td class="markdownTableBodyNone">-2.1%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(3s3p\)   </td><td class="markdownTableBodyNone">\({}^3P^o_0\)   </td><td class="markdownTableBodyNone">20908   </td><td class="markdownTableBodyNone">21850   </td><td class="markdownTableBodyNone">-4.3%    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(3s4p\)   </td><td class="markdownTableBodyNone">\({}^3P^o_0\)   </td><td class="markdownTableBodyNone">46917   </td><td class="markdownTableBodyNone">47841   </td><td class="markdownTableBodyNone">-1.9%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(3s6p\)   </td><td class="markdownTableBodyNone">\({}^3P^o_0\)   </td><td class="markdownTableBodyNone">53311   </td><td class="markdownTableBodyNone">54249   </td><td class="markdownTableBodyNone">-1.7%    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(3s3p\)   </td><td class="markdownTableBodyNone">\({}^3P^o_1\)   </td><td class="markdownTableBodyNone">20928   </td><td class="markdownTableBodyNone">21870   </td><td class="markdownTableBodyNone">-4.3%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(3s3p\)   </td><td class="markdownTableBodyNone">\({}^1P^o_1\)   </td><td class="markdownTableBodyNone">34491   </td><td class="markdownTableBodyNone">35051   </td><td class="markdownTableBodyNone">-1.6%    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(3s4p\)   </td><td class="markdownTableBodyNone">\({}^3P^o_1\)   </td><td class="markdownTableBodyNone">46920   </td><td class="markdownTableBodyNone">47844   </td><td class="markdownTableBodyNone">-1.9%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(3s3p\)   </td><td class="markdownTableBodyNone">\({}^3P^o_2\)   </td><td class="markdownTableBodyNone">20969   </td><td class="markdownTableBodyNone">21911   </td><td class="markdownTableBodyNone">-4.3%    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(3s4p\)   </td><td class="markdownTableBodyNone">\({}^3P^o_2\)   </td><td class="markdownTableBodyNone">46927   </td><td class="markdownTableBodyNone">47851   </td><td class="markdownTableBodyNone">-1.9%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(3s6p\)   </td><td class="markdownTableBodyNone">\({}^3P^o_2\)   </td><td class="markdownTableBodyNone">53315   </td><td class="markdownTableBodyNone">54253   </td><td class="markdownTableBodyNone">-1.7%   </td></tr>
</table>
<p>The table shows the results of the calculation, and comparison to experimental excitation energies, in units of \({\rm cm}^{-1}\) (for the ground state, the ionisation potential is instead shown). The agreement is at the ~few % level.</p>
<hr  />
<h2>CI+MBPT example <a class="anchor" id="basic"></a></h2>
<p>Here, we will improve the accuracy of the calculation by including the MBPT corrections. We do this by setting <code>sigma1</code> and <code>sigma2</code> options to true.</p>
<div class="fragment"><div class="line"><a class="code hl_namespace" href="namespaceCI.html">CI</a>{</div>
<div class="line">  ci_basis = 20spdf;</div>
<div class="line">  J+ = 0,1,2;</div>
<div class="line">  J- = 0,1,2;</div>
<div class="line">  num_solutions = 3;</div>
<div class="line">  sigma1 = <span class="keyword">true</span>;</div>
<div class="line">  sigma2 = <span class="keyword">true</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>This will use the full basis (from <code>Basis{}</code>) for the MBPT part. In this case, it was <code>30spdfghi</code>. (Different subsets of the full basis can be used for the internal lines of the \(\Sigma^1\) and \(\Sigma^2\) diagrams using the <code>s1_basis</code> and <code>s2_basis</code> options, respectively).</p>
<p>The code will now calculate more \(Q^k\) Coulomb integrals, since they are required in the MBPT calculations. It will read in the existing file (if there is one), so it doesn't need to start from scratch, and only calculate the missing integrals:</p>
<div class="fragment"><div class="line">Calculate two-body Coulomb integrals: Q^k_abcd</div>
<div class="line">Read 15896631 integrals from file: Mg2.qk</div>
<div class="line">For: 20spdf</div>
<div class="line">fill: T = 947.11 ms</div>
<div class="line">and: 30spdfghi</div>
<div class="line">fill: T = 1.07 mins</div>
<div class="line">Summary: </div>
<div class="line">k=0: 1235215 [1447153]</div>
<div class="line">k=1: 6337133 [6984629]</div>
<div class="line">k=2: 10584749 [12117689]</div>
<div class="line">k=3: 9629901 [12117689]</div>
<div class="line">k=4: 7888486 [12117689]</div>
<div class="line">k=5: 5720196 [11200489]</div>
<div class="line">k=6: 3267217 [6456007]</div>
<div class="line">k=7: 997236 [1056323]</div>
<div class="line">k=8: 0 [2]</div>
<div class="line">Total: 45660133 non-zero integrals</div>
<div class="line">Calculated 29763502 new Coulomb integrals</div>
<div class="line">Writing 45660133 integrals to file: Mg2.qk..</div>
</div><!-- fragment --><p>This uses close to 5Gb of memory, so may already be difficulty on some laptops. Then, is will calculate the matrix elements of the two-body \(\Sigma^2\) operator. This is the slow part of the calculation. Fortunately, the \(\Sigma^2\) correction is rather small, and good accuracy can be obtained by only including matrix elements between the lowest few valence-space basis states. By default, it will include up to \(n=n_{\rm core}+3\), where \(n_{\rm core}\) is the largest \(n\) in the core, for each \(l\) in the <code>ci_basis</code>. This can be controlled manually with the <code>cis2_basis</code> option.</p>
<div class="fragment"><div class="line">Calculate two-body MBPT integrals: Sigma^k_abcd</div>
<div class="line">For: 5spdf, using 30spdfghi</div>
<div class="line">Count non-zero: 0.89 ms</div>
<div class="line">Reserve: 0.17 ms</div>
<div class="line">Fill w/ zeros: 4.61 ms</div>
<div class="line">Fill w/ values: 8.49 s</div>
<div class="line">Summary: </div>
<div class="line">k=0: 5151 [5503]</div>
<div class="line">k=1: 32131 [33223]</div>
<div class="line">k=2: 45451 [45481]</div>
<div class="line">k=3: 32131 [33223]</div>
<div class="line">k=4: 12403 [12983]</div>
<div class="line">k=5: 2701 [2753]</div>
<div class="line">k=6: 300 [313]</div>
<div class="line">k=7: 10 [11]</div>
<div class="line">Total: 130278 non-zero integrals</div>
<div class="line">fill: T = 8.50 s</div>
<div class="line">Calculated 130278 new MBPT integrals</div>
<div class="line">Writing 130278 integrals to file: Mg2_1_30spdfghi_8.sk..</div>
</div><!-- fragment --><p>The <code>For: 5spdf, using 30spdfghi</code> means the external lines in \(\Sigma_{ijkl}\) include up to <code>5spdf</code>, while the internal lines use the full <code>30spdfghi</code> basis.</p>
<p>This leads to a significant improvement in the accuracy:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Level   </th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">AMPSCI   </th><th class="markdownTableHeadNone">Exp.   </th><th class="markdownTableHeadNone">\(\Delta\)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(3s^2\)   </td><td class="markdownTableBodyNone">\({}^1S_0\)   </td><td class="markdownTableBodyNone">-182804   </td><td class="markdownTableBodyNone">-182939   </td><td class="markdownTableBodyNone">-0.07%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(3s4s\)   </td><td class="markdownTableBodyNone">\({}^1S_0\)   </td><td class="markdownTableBodyNone">43490   </td><td class="markdownTableBodyNone">43503   </td><td class="markdownTableBodyNone">-0.03%    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(3s6s\)   </td><td class="markdownTableBodyNone">\({}^1S_0\)   </td><td class="markdownTableBodyNone">52526   </td><td class="markdownTableBodyNone">52556   </td><td class="markdownTableBodyNone">-0.06%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(3s4s\)   </td><td class="markdownTableBodyNone">\({}^3S_1\)   </td><td class="markdownTableBodyNone">41208   </td><td class="markdownTableBodyNone">41197   </td><td class="markdownTableBodyNone">0.03%    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(3s3d\)   </td><td class="markdownTableBodyNone">\({}^3D_1\)   </td><td class="markdownTableBodyNone">47957   </td><td class="markdownTableBodyNone">47957   </td><td class="markdownTableBodyNone">0.00%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(3s5s\)   </td><td class="markdownTableBodyNone">\({}^3S_1\)   </td><td class="markdownTableBodyNone">51875   </td><td class="markdownTableBodyNone">51873   </td><td class="markdownTableBodyNone">0.00%    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(3s3d\)   </td><td class="markdownTableBodyNone">\({}^1D_2\)   </td><td class="markdownTableBodyNone">46385   </td><td class="markdownTableBodyNone">46403   </td><td class="markdownTableBodyNone">-0.04%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(3s3d\)   </td><td class="markdownTableBodyNone">\({}^3D_2\)   </td><td class="markdownTableBodyNone">47960   </td><td class="markdownTableBodyNone">47957   </td><td class="markdownTableBodyNone">0.01%    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(3s4d\)   </td><td class="markdownTableBodyNone">\({}^1D_2\)   </td><td class="markdownTableBodyNone">53113   </td><td class="markdownTableBodyNone">53135   </td><td class="markdownTableBodyNone">-0.04%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(3s3p\)   </td><td class="markdownTableBodyNone">\({}^3P^o_0\)   </td><td class="markdownTableBodyNone">21822   </td><td class="markdownTableBodyNone">21850   </td><td class="markdownTableBodyNone">-0.13%    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(3s4p\)   </td><td class="markdownTableBodyNone">\({}^3P^o_0\)   </td><td class="markdownTableBodyNone">47837   </td><td class="markdownTableBodyNone">47841   </td><td class="markdownTableBodyNone">-0.01%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(3s6p\)   </td><td class="markdownTableBodyNone">\({}^3P^o_0\)   </td><td class="markdownTableBodyNone">54271   </td><td class="markdownTableBodyNone">54249   </td><td class="markdownTableBodyNone">0.04%    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(3s3p\)   </td><td class="markdownTableBodyNone">\({}^3P^o_1\)   </td><td class="markdownTableBodyNone">21844   </td><td class="markdownTableBodyNone">21870   </td><td class="markdownTableBodyNone">-0.12%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(3s3p\)   </td><td class="markdownTableBodyNone">\({}^1P^o_1\)   </td><td class="markdownTableBodyNone">35090   </td><td class="markdownTableBodyNone">35051   </td><td class="markdownTableBodyNone">0.11%    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(3s4p\)   </td><td class="markdownTableBodyNone">\({}^3P^o_1\)   </td><td class="markdownTableBodyNone">47840   </td><td class="markdownTableBodyNone">47844   </td><td class="markdownTableBodyNone">-0.01%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(3s3p\)   </td><td class="markdownTableBodyNone">\({}^3P^o_2\)   </td><td class="markdownTableBodyNone">21876   </td><td class="markdownTableBodyNone">21911   </td><td class="markdownTableBodyNone">-0.16%    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(3s4p\)   </td><td class="markdownTableBodyNone">\({}^3P^o_2\)   </td><td class="markdownTableBodyNone">47845   </td><td class="markdownTableBodyNone">47851   </td><td class="markdownTableBodyNone">-0.01%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(3s6p\)   </td><td class="markdownTableBodyNone">\({}^3P^o_2\)   </td><td class="markdownTableBodyNone">54272   </td><td class="markdownTableBodyNone">54253   </td><td class="markdownTableBodyNone">0.03%   </td></tr>
</table>
<p>The discrepancies are now at the level of 0.1% or below.</p>
<p>On my pc, this entire calculation took less than two minutes.</p>
<hr  />
<h2>Matrix elements <a class="anchor" id="matrix"></a></h2>
<p>This takes very similar options to the regular <code>MatrixElements{}</code> module:</p>
<div class="fragment"><div class="line"><span class="comment">// Available Module::CI_matrixElements options/blocks</span></div>
<div class="line"><a class="code hl_function" href="namespaceModule.html#a48c4083e38b479fd5576f20c291aca82">Module::CI_matrixElements</a>{</div>
<div class="line">  <span class="comment">// e.g., E1, hfs (see ampsci -o for available operators)</span></div>
<div class="line">  operator;</div>
<div class="line">  <span class="comment">// options specific to operator</span></div>
<div class="line">  options{}</div>
<div class="line">  <span class="comment">// Method used for RPA: true(=TDHF), false, TDHF, basis, diagram</span></div>
<div class="line">  rpa;</div>
<div class="line">  <span class="comment">// Text or number. Freq. for RPA (and freq. dependent operators). Put &#39;each&#39;</span></div>
<div class="line">  <span class="comment">// to solve at correct frequency for each transition. [0.0]</span></div>
<div class="line">  omega;</div>
<div class="line">  <span class="comment">// List of angular momentum Js to calculate matrix elements for. If blank, all</span></div>
<div class="line">  <span class="comment">// available Js will be calculated. Must be integers (two-electron only).</span></div>
<div class="line">  J;</div>
<div class="line">  <span class="comment">// As above, but for EVEN CSFs only (takes precedence over J).</span></div>
<div class="line">  J+;</div>
<div class="line">  <span class="comment">// As above, but for ODD CSFs (takes precedence over J).</span></div>
<div class="line">  J-;</div>
<div class="line">  <span class="comment">// Maximum solution number to calculate MEs for. If blank, will calculate all.</span></div>
<div class="line">  num_solutions;</div>
<div class="line">}</div>
<div class="ttc" id="anamespaceModule_html_a48c4083e38b479fd5576f20c291aca82"><div class="ttname"><a href="namespaceModule.html#a48c4083e38b479fd5576f20c291aca82">Module::CI_matrixElements</a></div><div class="ttdeci">void CI_matrixElements(const IO::InputBlock &amp;input, const Wavefunction &amp;wf)</div><div class="ttdoc">Calculates matrix elements for CI wavefunctions.</div><div class="ttdef"><b>Definition</b> matrixElements.cpp:1029</div></div>
</div><!-- fragment --><p>It's typically not recommended to use <code>omega=each</code>, as this solves the RPA equations for each transition, and the frequency-dependence is usually small.</p>
<div class="fragment"><div class="line">Module::CI_MatrixElements{</div>
<div class="line">  operator = E1;</div>
<div class="line">  rpa = <span class="keyword">true</span>;</div>
<div class="line">  omega = 0.15970531;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The output is something like:</p>
<div class="fragment"><div class="line">CI Matrix Elements -  Operator: E1</div>
<div class="line">Units: |e|aB</div>
<div class="line">Including RPA: TDHF method</div>
<div class="line">Solving RPA at fixed frequency: w=0.159705</div>
<div class="line">TDHF E1 (w=0.1597): 13 7.5e-09 [1s+,p-]</div>
<div class="line"> </div>
<div class="line">Ja  # conf     - Jb  # conf      w_ab     t_ab</div>
<div class="line">0+  0 3s^2 1S  - 1-  0 3s3p 3Po  0.09949 -1.23847e-03</div>
<div class="line">0+  0 3s^2 1S  - 1-  1 3s3p 1Po  0.15989 -4.02693e+00</div>
<div class="line">0+  1 3s4s 1S  - 1-  0 3s3p 3Po  0.09865 -1.68797e-03</div>
<div class="line">0+  1 3s4s 1S  - 1-  1 3s3p 1Po  0.03825 -4.24587e+00</div>
<div class="line">1-  0 3s3p 3Po - 0+  0 3s^2 1S   0.09949  1.23847e-03</div>
<div class="line">1-  0 3s3p 3Po - 0+  1 3s4s 1S   0.09865  1.68797e-03</div>
<div class="line">1-  1 3s3p 1Po - 0+  0 3s^2 1S   0.15989  4.02693e+00</div>
<div class="line">1-  1 3s3p 1Po - 0+  1 3s4s 1S   0.03825  4.24587e+00</div>
</div><!-- fragment --><p>(this is for a reduced set of levels).</p>
<p>This implies the lifetime of the first \({}^1P^o_1\) level is 2.12 ns, in excellent agreement with experiment.</p>
<hr  />
<ul>
<li>See physics documentation: <a href="https://ampsci.dev/ampsci.pdf">ampsci.pdf</a> for full physics description of the employed methods </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="tutorials.html">Tutorials and Examples</a></li>
    <li class="footer">Generated on Mon Mar 2 2026 04:48:12 for ampsci by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
