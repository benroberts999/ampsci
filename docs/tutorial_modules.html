<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" class="light-mode">
    <head>
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=9" />
        <meta name="generator" content="Doxygen 1.9.8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>ampsci:
            Matrix Elements</title>
        <link href="tabs.css" rel="stylesheet" type="text/css" />
        <script type="text/javascript" src="jquery.js"></script>
        <script type="text/javascript" src="dynsections.js"></script>
        <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
        <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
        <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="./MathJax.js"></script>
        <link href="doxygen.css" rel="stylesheet" type="text/css" />
        <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="blue-theme.css" rel="stylesheet" type="text/css"/>
        <!-- ... other metadata & script includes ... -->
        <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
        <script type="text/javascript">
            DoxygenAwesomeFragmentCopyButton.init()
        </script>
        <!-- <script>
            document.documentElement.classList.add("light-mode");
        </script> -->
    </head>
    <body>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div id="titlearea">
                <table cellspacing="0" cellpadding="0">
                    <tbody>
                        <tr style="height: 56px;">
                            <td id="projectalign" style="padding-left: 0.5em;">
                                <div id="projectname">ampsci
                                </div>
                                <div
                                    id="projectbrief">High-precision calculations for one- and two-valence atomic systems</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('tutorial_modules.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Matrix Elements</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Calculate matrix elements of various operators.</p>
<p>Here, we'll see how to use an ampsci <code>Module</code> to calculate matrix elements of various opertors.</p>
<p>This assumes you already have ampsci compiled, and are familiar with running basic calculations.</p>
<ul>
<li>See <a class="el" href="getting_started.html">Getting Started</a> for basic compilation instructions</li>
<li>See <a class="el" href="tutorial_basic.html">basic Tutorial</a> for running basic calculations</li>
<li>See <a class="el" href="tutorial_mbpt.html">MBPT and Correlations</a> for running more advanced calculations.</li>
</ul>
<h2>Modules: using the wavefunctions <a class="anchor" id="modules"></a></h2>
<p>Above, we ran ampsci, which calculated the atomic wavefunctions and printed their energies to screen. If we want to actually <em>do</em> anything with the wavefunctions, we have to run one or more <b>modules</b>. We do this by adding a module block to the input file, which has the form <code>Module::ModuleName{}</code>. We can see a list of all available modules with the <code>-m</code> command-line option:</p>
<div class="shell-block"> <div class="fragment"><div class="line">./ampsci -m</div>
</div><!-- fragment --> </div><p>The general usage of the code is to first use the main blocks to construct the atomic wavefunction and basis states, then to add as many <code>Module::</code> blocks as required. Each module is a separate routine that will take the calculated wavefunction and compute any desired property (e.g., matrix elements). They are independent and do not talk to each other, though may write output to the disk. There are several available modules, here we will just focus on calculating matrix elements. The code is designed so that anyone can write a new Module to calculate anything else they may desire.</p>
<ul>
<li>See <a class="el" href="tutorial_modules.html#modules">Modules</a> for more detail on general modules<ul>
<li>Use <code>ampsci -m</code> to see a list of available modules</li>
</ul>
</li>
<li>And <a class="el" href="modules_custom.html">Writing Custom Modules</a> for information on writing your own custom module</li>
</ul>
<h2>Calculating matrix elements</h2>
<p>When we ran <code>./ampsci -m</code>, we would have seen a large list of available modules. One of them would have been called <code>matrixElements</code>. We tell amplsci to run this module by adding it as an input block to the input file:</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="namespaceModule.html#aad4d284d8f72582faa35e991c685c9b5">Module::matrixElements</a>{}</div>
<div class="ttc" id="anamespaceModule_html_aad4d284d8f72582faa35e991c685c9b5"><div class="ttname"><a href="namespaceModule.html#aad4d284d8f72582faa35e991c685c9b5">Module::matrixElements</a></div><div class="ttdeci">void matrixElements(const IO::InputBlock &amp;input, const Wavefunction &amp;wf)</div><div class="ttdoc">Calculates matrix elements of any tensor operator, with RPA.</div><div class="ttdef"><b>Definition</b> matrixElements.cpp:31</div></div>
</div><!-- fragment --><p>Most modules will take input options. To see the available options for this module, list the block name after <code>-m</code> on the command-line:</p>
<div class="shell-block"> <div class="fragment"><div class="line">./ampsci -m matrixElements</div>
</div><!-- fragment --> </div><p>(or <code>./ampsci -i Module::matrixElements</code>), which prints:</p>
<div class="fragment"><div class="line"><span class="comment">// Available Module::matrixElements options/blocks</span></div>
<div class="line"><a class="code hl_function" href="namespaceModule.html#aad4d284d8f72582faa35e991c685c9b5">Module::matrixElements</a>{</div>
<div class="line">  operator;</div>
<div class="line">    <span class="comment">// e.g., E1, hfs (see ampsci -o for available operators)</span></div>
<div class="line">  options{}</div>
<div class="line">    <span class="comment">// options specific to operator (see ampsci -o</span></div>
<div class="line">    <span class="comment">// &#39;operator&#39;)</span></div>
<div class="line">  rpa;</div>
<div class="line">    <span class="comment">// Method used for RPA: true(=TDHF), false, TDHF, basis,</span></div>
<div class="line">    <span class="comment">// diagram [true]</span></div>
<div class="line">  rpa_options{}</div>
<div class="line">    <span class="comment">// Block: some further options for RPA</span></div>
<div class="line">  omega;</div>
<div class="line">    <span class="comment">// Text or number. Freq. for RPA (and freq. dependent</span></div>
<div class="line">    <span class="comment">// operators). Put &#39;each&#39; to solve at correct frequency</span></div>
<div class="line">    <span class="comment">// for each transition. [0.0]</span></div>
<div class="line">  printBoth;</div>
<div class="line">    <span class="comment">// print &lt;a|h|b&gt; and &lt;b|h|a&gt; [false]</span></div>
<div class="line">  include_core;</div>
<div class="line">    <span class="comment">// If true, includes core states in calculation. Will</span></div>
<div class="line">    <span class="comment">// use HF core, unless use_spectrum is true [false]</span></div>
<div class="line">  use_spectrum;</div>
<div class="line">    <span class="comment">// If true (and spectrum available), will use spectrum</span></div>
<div class="line">    <span class="comment">// for valence states [false]</span></div>
<div class="line">  diagonal;</div>
<div class="line">    <span class="comment">// Calculate diagonal matrix elements (if non-zero)</span></div>
<div class="line">    <span class="comment">// [true]</span></div>
<div class="line">  off-diagonal;</div>
<div class="line">    <span class="comment">// Calculate off-diagonal matrix elements (if non-zero)</span></div>
<div class="line">    <span class="comment">// [true]</span></div>
<div class="line">  moments;</div>
<div class="line">    <span class="comment">// true/false - calculate moments, or reduced matrix</span></div>
<div class="line">    <span class="comment">// elements. Default is false, except for hyperfine</span></div>
<div class="line">    <span class="comment">// operators</span></div>
<div class="line">  StructureRadiation{}</div>
<div class="line">    <span class="comment">// Options for Structure Radiation and normalisation</span></div>
<div class="line">    <span class="comment">// (details below)</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Available StructureRadiation options/blocks</span></div>
<div class="line">StructureRadiation{</div>
<div class="line">  <span class="comment">// If this block is included, SR + Normalisation</span></div>
<div class="line">  <span class="comment">// corrections will be included</span></div>
<div class="line">  Qk_file;</div>
<div class="line">    <span class="comment">// true/false/filename - SR: filename for QkTable file.</span></div>
<div class="line">    <span class="comment">// If blank will not use QkTable; if exists, will read</span></div>
<div class="line">    <span class="comment">// it in; if doesn&#39;t exist, will create it and write to</span></div>
<div class="line">    <span class="comment">// disk. If &#39;true&#39; will use default filename. Save time</span></div>
<div class="line">    <span class="comment">// (10x) at cost of memory. Note: Using QkTable implies</span></div>
<div class="line">    <span class="comment">// splines used for diagram legs</span></div>
<div class="line">  n_minmax;</div>
<div class="line">    <span class="comment">// list; min,max n for core/excited: [1,inf]</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Available rpa_options options/blocks</span></div>
<div class="line">rpa_options{</div>
<div class="line">  eps;</div>
<div class="line">    <span class="comment">// Convergance goal [1.0e-10]</span></div>
<div class="line">  eta;</div>
<div class="line">    <span class="comment">// Damping factor - be carful with this [0.4]</span></div>
<div class="line">  max_iterations;</div>
<div class="line">    <span class="comment">// Maximum number of iterations. 1 should correspond to</span></div>
<div class="line">    <span class="comment">// first-order RPA [100]</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>The first option, <code>operator</code> is which operator we want to calculate matrix elements of. You can see a list of operators with the <code>-o</code> command-line option:</p>
<div class="shell-block"> <div class="fragment"><div class="line">./ampsci -o</div>
</div><!-- fragment --> </div><p>The second option, which is a sub-input-block, <code>options</code> is the set of options for the given operator. Most operators have no extra options, so this can be left blank. Some (e.g., hyperfine operator <code>hfs</code> have many available options). Like above, you can see the available options by further passing the operator name after <code>-o</code>. For example:</p>
<div class="shell-block"> <div class="fragment"><div class="line">./ampsci -o hfs</div>
</div><!-- fragment --> </div><p>Here we will consider the simpler <code>E1</code> operator. To our above <code>example.in</code> file, we can add the following block (note we may add as many Module:: blocks as we like, they will all be run one-by-one in order):</p>
<div class="fragment"><div class="line">Module::Matrixelements{</div>
<div class="line">  operator = E1;</div>
<div class="line">  rpa = <span class="keyword">true</span>;</div>
<div class="line">  omega = 0.0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The <code>omega = 0.0;</code> option means we have solved RPA equations for each transition at zero frequency. It is also possible to automatically solve RPA for each transition frequency by setting: <code>omega = each;</code>. See <a href="https://ampsci.dev/ampsci.pdf">ampsci.pdf</a> for description of RPA.</p>
<p>The output format will depend on the specific module. In this case, we are shown the extent to which the RPA (/TDHF) equations converged, and then the valued of the reduced matrix elements are printed (at the Hartree-Fock, first-order core-polarisation, and all-orders RPA levels)</p>
<hr  />
<h2>MBPT for matrix elements: Core Polarisation/RPA <a class="anchor" id="rpa"></a></h2>
<p>Core polarisation (RPA) is included in the matrix elements.</p>
<p>The best method to use is TDHF, which is numerically stable, and includes contribution from negative energy states automatically.</p>
<hr  />
<h2>MBPT for matrix elements: Structure Radiation <a class="anchor" id="sructrad"></a></h2>
<p>To improve tha accuracy of matrix elements, structure radiation and normalisation corrections should be included. There is an option to do this in the MatrixElements module. There is also a <code>Module::StructureRad</code> module, which gives some finer control.</p>
<div class="fragment"><div class="line"><span class="comment">// Available Module::matrixElements options/blocks</span></div>
<div class="line"><a class="code hl_function" href="namespaceModule.html#aad4d284d8f72582faa35e991c685c9b5">Module::matrixElements</a>{</div>
<div class="line">  <span class="comment">//.... same as before</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Options for Structure Radiation and normalisation (details below)</span></div>
<div class="line">  StructureRadiation{}</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// Available StructureRadiation options/blocks</span></div>
<div class="line">StructureRadiation{</div>
<div class="line">  <span class="comment">// If this block is included, SR + Normalisation corrections will be included</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// filename for QkTable file. If blank will not use QkTable; if exists, will</span></div>
<div class="line">  <span class="comment">// read it in; if doesn&#39;t exist, will create it and write to disk. Save time</span></div>
<div class="line">  <span class="comment">// (10x) at cost of memory. Note: Using QkTable implies splines used for</span></div>
<div class="line">  <span class="comment">// diagram legs</span></div>
<div class="line">  Qk_file;</div>
<div class="line">  <span class="comment">// list; min,max n for core/excited: [1,inf]</span></div>
<div class="line">  n_minmax;</div>
<div class="line">}</div>
</div><!-- fragment --><p>If a Qk filename is given, program will first calculate all required Q^k Coulomb integrals before calculating structure radiation. This speeds up the calculation, at a great memory cost. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="tutorials.html">Tutorials and Examples</a></li>
    <li class="footer">Generated on Mon Mar 2 2026 04:48:12 for ampsci by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
