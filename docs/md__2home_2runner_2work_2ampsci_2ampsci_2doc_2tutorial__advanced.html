<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ampsci: Advanced Tutorial: MBPT</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="./MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<!-- ... other metadata & script includes ... -->
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ampsci
   </div>
   <div id="projectbrief">c++ program for high-precision atomic structure calculations of single-valence systems</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Advanced Tutorial: MBPT</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md10"></a> brief Advanced ampsci tutorial: correlations</p>
<p>This assumes you already have ampsci compiled and have a basic understanding of how to run and use it.</p>
<ul>
<li>See <a class="el" href="md__2home_2runner_2work_2ampsci_2ampsci_2doc_2tutorial.html">doc/tutorial.md</a> for the basic tutorial</li>
<li>See <a href="https://ampsci.dev/ampsci.pdf">ampsci.dev/ampsci.pdf</a> for full description of the physics</li>
<li>There are several examples in <a href="doc/examples/">doc/examples/</a> - also try running those, and comparing the output to the expected output</li>
</ul>
<h1>Contents</h1>
<ul>
<li><a class="el" href="md__2home_2runner_2work_2ampsci_2ampsci_2doc_2tutorial__advanced.html#begin">Starting approximation:</a><ul>
<li><a class="el" href="md__2home_2runner_2work_2ampsci_2ampsci_2doc_2tutorial__advanced.html#hf">Hartree-Fock</a></li>
<li><a class="el" href="md__2home_2runner_2work_2ampsci_2ampsci_2doc_2tutorial__advanced.html#nuclear">Nuclear Potential</a></li>
<li><a class="el" href="md__2home_2runner_2work_2ampsci_2ampsci_2doc_2tutorial__advanced.html#breit">Breit</a></li>
<li><a class="el" href="md__2home_2runner_2work_2ampsci_2ampsci_2doc_2tutorial__advanced.html#qed">Radiative QED</a></li>
</ul>
</li>
<li><a class="el" href="md__2home_2runner_2work_2ampsci_2ampsci_2doc_2tutorial__advanced.html#basis">Constructing a basis</a><ul>
<li><a class="el" href="md__2home_2runner_2work_2ampsci_2ampsci_2doc_2tutorial__advanced.html#spectrum">Spectrum</a></li>
</ul>
</li>
<li><a class="el" href="md__2home_2runner_2work_2ampsci_2ampsci_2doc_2tutorial__advanced.html#secondorder">MBPT: second-order correlations</a></li>
<li><a class="el" href="md__2home_2runner_2work_2ampsci_2ampsci_2doc_2tutorial__advanced.html#allorders">MBPT: all-order correlations</a></li>
<li><a class="el" href="md__2home_2runner_2work_2ampsci_2ampsci_2doc_2tutorial__advanced.html#rpa">MBPT for matrix elements: Core Polarisation/RPA</a></li>
<li><a class="el" href="md__2home_2runner_2work_2ampsci_2ampsci_2doc_2tutorial__advanced.html#sructrad">MBPT for matrix elements: Structure Radiation</a></li>
</ul>
<h1>Starting approximation <a class="anchor" id="begin"></a></h1>
<p>The full atomic Hamiltonian for an \(N\)-electron atom:  </p><p class="formulaDsp">
\[
H = \sum_i^N h_0(r_i) + \sum_{i &lt; j}\frac{1}{r_i - r_j}
\]
</p>
<p class="formulaDsp">
\[
h_0(\vec{r_i}) = c \vec\alpha_i\cdot\vec{p_i} + c^2 (\beta_i-1) + V_{\rm nuc}.
\]
</p>
<p>The starting approximation is the Hartree-Fock method:</p>
<p class="formulaDsp">
\[
  H \approx \sum_i^N [h_0(\vec r_i) + v^{\rm HF} ].
\]
</p>
<h2>Hartree-Fock <a class="anchor" id="hf"></a></h2>
<p>We focus on case of single-valence systems, and start with so-called \(V^{N-1}\) approximation, in which Hartree-Fock potential is due to the \(N-1\) core electrons:</p>
<p class="formulaDsp">
\[
  \hat v^{\rm HF}\phi_a(\vec{r_1}) = \sum_{i\neq a}^{N_c}\Bigg(
  \int \frac{\phi_i^\dagger(\vec{r_2})\phi_i(\vec{r_2})}{|r_{12}|}d^3\vec{r_2}\,\phi_a(\vec{r_1})
  -\int \frac{\phi_i^\dagger(\vec{r_2})\phi_a(\vec{r_2})}{|r_{12}|}d^3\vec{r_2}\,\phi_i(\vec{r_1})
  \Bigg),
\]
</p>
<p>First, Hartree-Fock equations are solved self-consistently for all core electrons, then the valence states are found in the Frozen Hartree-Fock potential due to the core.</p>
<hr  />
<p>As always, begin by checking the available options:</p>
<div class="fragment"><div class="line">./ampsci -a HartreeFock</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">// Available HartreeFock options/blocks</span></div>
<div class="line">HartreeFock{</div>
<div class="line">  <span class="comment">// Options for solving lowest-order atomic wavefunction</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Core configuration. Either list entire core, or use [At] short-hand. e.g.,</span></div>
<div class="line">  <span class="comment">// [He] equivilant to 1s2; [Xe],6s1 equivilant to [Cs] and to</span></div>
<div class="line">  <span class="comment">// 1s2,2s2,...,5p6,6s1. Instead of one of the commas, you may use a &#39;:&#39; -</span></div>
<div class="line">  <span class="comment">// states above this are included into the core, but not excluded from the</span></div>
<div class="line">  <span class="comment">// valence list. Use this method for KohnSham, for example. [blank by default]</span></div>
<div class="line">  core;</div>
<div class="line">  <span class="comment">// Valence configuration in `basis string&#39; format. e.g., 7sp5df will include</span></div>
<div class="line">  <span class="comment">// valence states up to  n=7 for s and p, and up to n=5 for d and f states.</span></div>
<div class="line">  <span class="comment">// Automatically excludes states in the core (except those above the optional</span></div>
<div class="line">  <span class="comment">// &#39;:&#39;). [blank by default]</span></div>
<div class="line">  valence;</div>
<div class="line">  <span class="comment">// HF convergance goal [1.0e-13]</span></div>
<div class="line">  eps;</div>
<div class="line">  <span class="comment">// Method for mean-field approximation: HartreeFock, Hartree, KohnSham, Local</span></div>
<div class="line">  <span class="comment">// [HartreeFock]</span></div>
<div class="line">  method;</div>
<div class="line">  <span class="comment">// Scale for factor for Breit Hamiltonian. Usially 0.0 (no Breit) or 1.0 (full</span></div>
<div class="line">  <span class="comment">// Breit), but can take any value. [0.0]</span></div>
<div class="line">  Breit;</div>
<div class="line">  <span class="comment">// Include QED? Three options: true, false, valence. If &#39;valencel, will</span></div>
<div class="line">  <span class="comment">// include QED only into valence states, but not the core. Detailed QED</span></div>
<div class="line">  <span class="comment">// options are set within the RadPot{} block - if that block is not set,</span></div>
<div class="line">  <span class="comment">// defaults will be used. By default, this option is false, unless the</span></div>
<div class="line">  <span class="comment">// RadPot{} block exists, in which case it is true</span></div>
<div class="line">  QED;</div>
<div class="line">}</div>
</div><!-- fragment --><p>For example, to run Hartree-Fock for Cs with a \(V^{N-1}\) potential (i.e. Xe-like core),</p>
<div class="fragment"><div class="line">HartreeFock{</div>
<div class="line">  core = [Xe];</div>
<div class="line">  valence = 6sp5d;</div>
<div class="line">}</div>
</div><!-- fragment --><p>If you're unsire of core/valence states, use ampsci's ib-built periodic table</p>
<div class="fragment"><div class="line">-p</div>
</div><!-- fragment --><p> or </p><div class="fragment"><div class="line">-p Cs</div>
</div><!-- fragment --><p> which will give:</p>
<div class="fragment"><div class="line">  H                                                                  He </div>
<div class="line">  1                                                                   2 </div>
<div class="line"> Li  Be   B                                           C   N   O   F  Ne </div>
<div class="line">  3   4   5                                           6   7   8   9  10 </div>
<div class="line"> Na  Mg  Al                                          Si   P   S  Cl  Ar </div>
<div class="line"> 11  12  13                                          14  15  16  17  18 </div>
<div class="line">  K  Ca  Sc  Ti   V  Cr  Mn  Fe  Co  Ni  Cu  Zn  Ga  Ge  As  Se  Br  Kr </div>
<div class="line"> 19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36 </div>
<div class="line"> Rb  Sr   Y  Zr  Nb  Mo  Tc  Ru  Rh  Pd  Ag  Cd  In  Sn  Sb  Te   I  Xe </div>
<div class="line"> 37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53  54 </div>
<div class="line"> Cs  Ba  *   Hf  Ta   W  Re  Os  Ir  Pt  Au  Hg  Tl  Pb  Bi  Po  At  Rn </div>
<div class="line"> 55  56      72  73  74  75  76  77  78  79  80  81  82  83  84  85  86 </div>
<div class="line"> Fr  Ra  *   Rf  Db  Sg  Bh  Hs  Mt  Ds  Rg  Cn  Nh  Fl  Mc  Lv  Ts  Og </div>
<div class="line"> 87  88     104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 </div>
<div class="line"> </div>
<div class="line">      *  La  Ce  Pr  Nd  Pm  Sm  Eu  Gd  Tb  Dy  Ho  Er  Tm  Yb  Lu </div>
<div class="line">         57  58  59  60  61  62  63  64  65  66  67  68  69  70  71 </div>
<div class="line">      *  Ac  Th  Pa   U  Np  Pu  Am  Cm  Bk  Cf  Es  Fm  Md  No  Lr </div>
<div class="line">         89  90  91  92  93  94  95  96  97  98  99 100 101 102 103 </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Cs,  cesium.</div>
<div class="line">Z = 55;  A = 133 (default)</div>
<div class="line"> </div>
<div class="line">Electron config: [Xe],6s1   (guess)</div>
<div class="line"> = 1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 5s2 5p6 | 6s1 </div>
<div class="line"> </div>
<div class="line">Isotpe data:</div>
<div class="line">Cs-133 (Z=55, A=133)</div>
<div class="line">r_rms = 4.8041, c = 5.67073, mu = 2.5778, I = 3.5, parity = 1</div>
</div><!-- fragment --><hr  />
<p>Besides Hartree-Fock, other methods are available:</p>
<ul>
<li>Hartree: exchange term excluded</li>
<li>KohnSham: Uses Kohn-Sham density functional, which includes a localised exchange potential and Latter correction (nb: valence electron should be included into the 'core' here, i.e. &lsquo;core=[Xe]:6s1&rsquo;)<ul>
<li>The colon tells ampsci to include 6s1 into the core potential, but above the 'Fermi leve; (i.e., also allow it in the valence).</li>
</ul>
</li>
<li>ApproxHF: Approximate (localised) Hartree-Fock potential (only for tests)</li>
<li>Local: Uses a local parametric potential (Green's potential)</li>
</ul>
<p>e.g.,</p>
<div class="fragment"><div class="line">HartreeFock{</div>
<div class="line">  core = [Xe]:6s1;</div>
<div class="line">  valence = 6sp5d;</div>
<div class="line">  method = KohnSham;</div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h2>Nuclear Potential <a class="anchor" id="nuclear"></a></h2>
<p>If no innputs are given, the code will assume a Fermi-like distribution for the nuclear charge, and look up default values for the nuclear parameters (charge radius and skin thickness). The default values are chosen from the specified isotope in the <code>Atom{}</code> block. These may also be specified specifically:</p>
<div class="fragment"><div class="line"><span class="comment">// Available Nucleus options/blocks</span></div>
<div class="line">Nucleus{</div>
<div class="line">  <span class="comment">// Options for nuclear potential (finite nuclear size). All are optional.</span></div>
<div class="line">  <span class="comment">// Default is a Fermi-like nucleus, with parameters chosen according to</span></div>
<div class="line">  <span class="comment">// isotope (see Atom{A;})</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Root-mean-square charge radius, in fm. If not given, will use default for</span></div>
<div class="line">  <span class="comment">// given Z and A.</span></div>
<div class="line">  rrms;</div>
<div class="line">  <span class="comment">// Half-density radius, in fm. ( If c and rrms are defined, c will over-ride</span></div>
<div class="line">  <span class="comment">// rms). Default depends on Z and A.</span></div>
<div class="line">  c;</div>
<div class="line">  <span class="comment">// Fermi, spherical, point-like, Gaussian [Fermi], custom</span></div>
<div class="line">  type;</div>
<div class="line">  <span class="comment">// Nuclear skin thickness, in fm [2.3]</span></div>
<div class="line">  t;</div>
<div class="line">  <span class="comment">// Intrinsic nuclear quadrupole deformation parameter beta (Currently only for</span></div>
<div class="line">  <span class="comment">// Fermi potential) [0.0]</span></div>
<div class="line">  beta;</div>
<div class="line">  <span class="comment">// Read potential from given file of the form (r v(r)) (space delimetered, in</span></div>
<div class="line">  <span class="comment">// atomic units) - will be interpolated onto atomic grid. Note: potential will</span></div>
<div class="line">  <span class="comment">// be extrapolated to larger R, assuming ~1/R, but will NOT be extrapolated to</span></div>
<div class="line">  <span class="comment">// smaller R. So, ensure smallest required {r V(r)} is given</span></div>
<div class="line">  input_file;</div>
<div class="line">  <span class="comment">// List of comma separated real numbers. Not currently unused, but may be used</span></div>
<div class="line">  <span class="comment">// in future for more complicated nuclear distros.</span></div>
<div class="line">  parameters;</div>
<div class="line">}</div>
</div><!-- fragment --><ul>
<li>rrms: nuclear root-mean-square charge radius, in fm</li>
<li>type: Nuclear charge distribution. The available nuclear types are: Fermi, spherical, point-like, and Gaussian, with Fermi being the default.<ul>
<li>c: nuclear half-density radius (only meaningful for Fermi distribution). Usually this is not set; if it is set, it will <em>override</em> rrms: \(3c^2=5r_{\rm rms}^2-7\pi^2a^2\), and \(t=4a~{\rm ln}3\)</li>
<li>t: nuclear `&lsquo;skin thickness&rsquo;' (90-10% fall-off radius), in fm. Only for Fermi distribution.</li>
<li>\(3c^2=5r_{\rm rms}^2-7\pi^2a^2\), and \(t=4a~{\rm ln}3\)</li>
</ul>
</li>
</ul>
<p>Default rms values are taken from:</p>
<ul>
<li>Angeli, Marinova, <a href="http://dx.doi.org/10.1016/j.adt.2011.12.006">At. Data Nucl. Data Tables <b>99</b>, 69 (2013)</a>.</li>
</ul>
<p>It's typically best to leave these as the default parameters, but you're free to update them, e.g., the following will assume a spherically-symmetric nucleus with rms charge radius of 3.5 fm:</p>
<div class="fragment"><div class="line">Nucleus{</div>
<div class="line">  rrms = 3.5;</div>
<div class="line">  type = spherical;</div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h2>Breit <a class="anchor" id="breit"></a></h2>
<p>The Breit Hamiltonian accounts for magnetic interactions between electrons (also known as the Gaunt interaction), and retardation effects. It leads to a correction to the electron-electron Coulomb term in the many-body Hamiltonian:</p>
<p class="formulaDsp">
\[
  \sum_{ij}\frac{1}{r_{ij}}
  \to
  \sum_{ij}\left( \frac{1}{r_{ij}} + \hat h^B_{ij}\right),
\]
</p>
<p>where, in the limit of zero frequency, the two-particle Breit Hamiltonian is</p>
<p class="formulaDsp">
\[
  h^B_{ij} = - \frac{\vec{\alpha_i}\cdot\vec{\alpha_j} + (\vec{\alpha_i}\cdot\hat{n_{ij}})(\vec{\alpha_j}\cdot\hat{n_{ij}})}{2\, r_{ij}}.
\]
</p>
<p>This can be included at the Hartree-Fock level with the <code>HartreeFock{Breit = 1.0;}</code> setting.</p>
<div class="fragment"><div class="line">HartreeFock{</div>
<div class="line">  core = [Xe];</div>
<div class="line">  valence = 6sp5d;</div>
<div class="line">  Breit = 1.0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>This setting is a scaling factor; i.e., setting <code>Breit = 0.5;</code> will add effective factor of 0.5 in front of \(h^B\). Typically, only 0 or 1 is set; other values are useful for checking for non-physical non-linear-in-Breit effects.</p>
<p><b>Note:</b> it's very important when including Breit effects along with correlations that the Breit Hamiltonian is included in the Dirac equation when forming the basis used to construct the correlation potential! This is to ensure basis is orthogonal to the Hartree-Fock core states At the moment, there is no way to include the Breit effect into the Hartree-Fock Green's function; as a result, we cannot include Breit at the level of all-order correlations (see below).</p>
<hr  />
<h2>Radiative QED <a class="anchor" id="qed"></a></h2>
<p>Radiative QED corrections can be included into the wavefunctions using the Flambaum-Ginges radiative potential method. An effective potential, \(V_{\rm rad}\), is added to the Hamiltonian before the equations are solved. The potential can be written as the sum of the Uehling (vacuum polarisation), Wichmann-Kroll (higher-order vacuum polarisation) and self-energy potentials; the self-energy potential itself is written as the sum of the high- and low-frequency electric contributions, and the magnetic contribution:</p>
<p class="formulaDsp">
\[
  V_{\rm rad}(\vec{r}) = V_{\rm Ueh}(r) + V_{\rm WK}(r) + V_{\rm SE}^{h}(r) +  V_{\rm SE}^{l}(r) + i (\vec{\gamma}\cdot\hat{n}) V^{\rm mag}(r).
\]
</p>
<ul>
<li>Flambaum, Ginges, <a href="http://link.aps.org/doi/10.1103/PhysRevA.72.052115">Phys. Rev. A <b>72</b>, 052115 (2005)</a>.</li>
</ul>
<p>This can be included by setting <code>QED=true;</code> in the Hartree Fock block:</p>
<div class="fragment"><div class="line">HartreeFock{</div>
<div class="line">  core = [Xe];</div>
<div class="line">  valence = 6sp5d;</div>
<div class="line">  QED = <span class="keyword">true</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><ul>
<li>This will use all default values (see below)</li>
<li>You can also include QED into the valence states only (not the core), by setting <code>QED=valence;</code><ul>
<li>This is only really for tests, to check to contribution of QED in the core; if you do this, the valence will not be orthogonal to the core.</li>
</ul>
</li>
</ul>
<p>You can all set detailed QED options within the <code>RadPot{}</code> Block. If the <code>RadPot{}</code> block is included, then the QED radiative potential will be included with the default parameters.</p>
<div class="fragment"><div class="line">RadPot{}</div>
</div><!-- fragment --><p>equivalent to:</p>
<div class="fragment"><div class="line">RadPot{</div>
<div class="line">  Ueh = 1.0;</div>
<div class="line">  SE_h = 1.0;</div>
<div class="line">  SE_l = 1.0;</div>
<div class="line">  SE_m = 1.0;</div>
<div class="line">  WK = 0.0;</div>
<div class="line">  scale_l;</div>
<div class="line">  scale_rN;</div>
<div class="line">}</div>
</div><!-- fragment --><ul>
<li>Each of the (<code>Ueh, SE_h, SE_l, SE_m, WK</code>) options are scaling factors for their corresponding terms in the potential; typically 0 or 1, but can be tuned (for testing).</li>
<li><code>scale_l</code> takes a list of scaling factors for each l; these will rescale \(V_{\rm rad}\) for each partial wave. e.g., <code>scale_l = 0,1,0;</code> will include \(V_{\rm rad}\) for p states, but not s or d states.</li>
<li><code>scale_rN;</code> Re-scales the effective nuclear radius; used to test finite-nuclear size effects on \(V_{\rm rad}\). =1 means normal, =0 means assume point-like nucleus (when calculating \(V_{\rm rad}\)).</li>
</ul>
<hr  />
 <hr  />
<h1>Constructing a basis <a class="anchor" id="basis"></a></h1>
<p>We often require a full "compete" set of solutions to the Hartree-Fock equation in order to perform sums-over-states required in perturbation theory. To form these, the set of atomic orbitals are expanded as</p>
<p class="formulaDsp">
\[
  \phi_{n\kappa}(\vec{r}) = \sum_i^{2N} p_i S_i(\vec{r}),
\]
</p>
<p>where \(S_i\) are a set of \(2N\) basis orbitals that form an approximately complete set over a sub-domain of the radial grid \([0,r_{\rm max}]\) ( \(N\) is defined this way because of the duel set of positive/negative energy Dirac solutions). The \(p_i\) expansion coefficients are found by diagonalising the set of basis orbitals with respect to the Hamiltonian matrix, equivalent to solving the eigenvalue problem:  </p><p class="formulaDsp">
\[
  \langle{S_i}|h_{\rm HF} |S_j \rangle p_i = \varepsilon\langle S_i|S_j \rangle p_i.
\]
</p>
<p> There are \(2N\) solutions of eigenvalues \(\varepsilon\) with corresponding eigenvectors \(\vec{p}\), which correspond to the spectrum of stationary states; \(N\) of these correspond to negative-energy ( \(\varepsilon&lt;-mc^2\)) states.</p>
<p>For the \(S_i\) basis orbitals, we use the Duel-Kinetic-Balence basis of Beloy and Dereviano, and \(S_i\) is built from \(N_{\rm spl}\) B-splines of order \(k\).</p>
<ul>
<li>Beloy, Derevianko, <a href="https://linkinghub.elsevier.com/retrieve/pii/S0010465508001148">Comput. Phys. Commun. <b>179</b>, 310 (2008)</a>.</li>
</ul>
<div class="fragment"><div class="line"><span class="comment">// Available Basis options/blocks</span></div>
<div class="line">Basis{</div>
<div class="line">  <span class="comment">// Number of splines used in expansion [30]</span></div>
<div class="line">  number;</div>
<div class="line">  <span class="comment">// order of splines ~7-9 [7]</span></div>
<div class="line">  order;</div>
<div class="line">  <span class="comment">// minimum cavity radius (first internal knot) [1.0e-4]</span></div>
<div class="line">  r0;</div>
<div class="line">  <span class="comment">// Select cavity radius r0 for each l by position where |psi(r0)/psi_max|</span></div>
<div class="line">  <span class="comment">// falls below r0_eps [0.0]</span></div>
<div class="line">  r0_eps;</div>
<div class="line">  <span class="comment">// maximum cavity radius [40.0]</span></div>
<div class="line">  rmax;</div>
<div class="line">  <span class="comment">// states to keep (e.g., 30spdf20ghi)</span></div>
<div class="line">  states;</div>
<div class="line">  <span class="comment">// Force orthogonal to core [false]</span></div>
<div class="line">  orthogonalise;</div>
<div class="line">  <span class="comment">// Print all spline energies (for testing) [false]</span></div>
<div class="line">  print;</div>
<div class="line">  <span class="comment">// Include -ve energy states [false]]</span></div>
<div class="line">  positron;</div>
<div class="line">  <span class="comment">// Derevianko (DKB) or Johnson [Derevianko]</span></div>
<div class="line">  type;</div>
<div class="line">}</div>
</div><!-- fragment --><p><code>r0</code> is the location of the first 'internal' knot (first actual knot is always placed at r=0). We may instead set <code>r0_eps</code>, which automatically choses <code>r0</code> such that the core density \(\rho_l(r) = \sum_n|\phi_{nl}(r)|^2\) drops below given relative value \(\rho_l(r0)/\rho_{\rm max}&lt;{\rm r0\_{\rm eps}}\).</p>
<p>e.g, to calculate basis including up to \(n=30\) for states up to \(l=6\) in a cavity of 40 \(a_0\), using 40 B-splines of order 7:</p>
<div class="fragment"><div class="line">Atom{</div>
<div class="line">  Z = Cs;</div>
<div class="line">}</div>
<div class="line">HartreeFock{</div>
<div class="line">  core = [Xe];</div>
<div class="line">  valence = 6sp5d;</div>
<div class="line">}</div>
<div class="line">Basis{</div>
<div class="line">  number = 40;</div>
<div class="line">  order = 7;</div>
<div class="line">  r0 = 1.0e-4;</div>
<div class="line">  rmax = 40.0;</div>
<div class="line">  states = 30spdfghi;</div>
<div class="line">}</div>
</div><!-- fragment --><p>If Breit and/or QED is set (see above), these are included into Hamiltonian and thus into the basis also.</p>
<p>It's important to look at the output when generating the basis. In the above case (with all other default options for Cs), we get output like:</p>
<div class="fragment"><div class="line">Constructing B-spline basis with N=40, k=7. Storing: 30spdfghi</div>
<div class="line">Using Derevianko (Duel Kinetic Balance) type splines.</div>
<div class="line">Spline cavity l=0 s: (1.0e-04, 40.0)aB.</div>
<div class="line">Spline cavity l=1 p: (1.0e-04, 40.0)aB.</div>
<div class="line">Spline cavity l=2 d: (1.0e-04, 40.0)aB.</div>
<div class="line">Spline cavity l=3 f: (1.0e-04, 40.0)aB.</div>
<div class="line">Spline cavity l=4 g: (1.0e-04, 40.0)aB.</div>
<div class="line">Spline cavity l=5 h: (1.0e-04, 40.0)aB.</div>
<div class="line">Spline cavity l=6 i: (1.0e-04, 40.0)aB.</div>
<div class="line">Basis/core:</div>
<div class="line"> |&lt;3s+|3s+&gt;-1| = 2.9e-06</div>
<div class="line"> dE/E(4s+)     = 3.6e-05</div>
<div class="line"> &lt;3s+|22s+&gt;    = 6.7e-04</div>
<div class="line">Basis/valence:</div>
<div class="line"> |&lt;5d-|5d-&gt;-1| = 9.8e-08</div>
<div class="line"> dE/E(6s+)     = 1.7e-05</div>
<div class="line"> &lt;5d-|17d-&gt;    = 1.3e-04</div>
<div class="line">Basis: T = 344.00 ms</div>
</div><!-- fragment --><p>The line <code>Spline cavity l=0 s: (1.0e-04, 40.0)aB.</code> tells us the actual point of the first (internal) and final B-spline knot.</p>
<p>The most important output is the <code>Basis/core:</code> output - this tells us how orthogonal the generated basis is to the Hartree-Fock core. The MBPT formalism relies on the orthogonality here, so it's important to check. If the results are not good enough (the code will warn you with <code>**</code>), try increasing <code>rmax</code> and/or <code>number</code>.</p>
<p>In this case, the worst normality occurred for the 3s state, where the inner-product of the finite-difference (Hartree Fock) \(3s\) state and the corresponding basis \(3s\) state was different from 1 by parts in \(10^6\). The worst energy comparison was for \(4s\) state (parts in \(10^5\)), and the worst orthogonality comparison was for the \(3s\) finite-difference Hartree-Fock state, and the \(22s\) basis state, which were orthogonal to parts in \(10^4\).</p>
<p><code>Basis/valence:</code> Gives the same info, but for the valence states. In some cases, this is much less important, but on other cases, it matters. This is question of the physics approximation.</p>
<h2>Spectrum <a class="anchor" id="spectrum"></a></h2>
<p>The spectrum is the same as the basis (takes the same options), except that it also includes correlations (see below):</p>
<p class="formulaDsp">
\[
  \langle{S_i}|\hat h_{\rm HF} + \hat \Sigma|{S_j}\rangle p_i = \varepsilon\langle{S_i|S_j}\rangle p_i.
\]
</p>
<p>We typically use Basis to calculate \(\Sigma\) (or other MBPT corrections), and then use spectrum to calculate atomic properties where a direct sum-over-states is required (e.g., polarisabilities). Since we often only use basis to calculate MBPT corrections, it doesn't need to be very large. We directly use the spectrum, so we typically require a larger basis set. It's now typically also crucial for the spectrum to be orthogonal to the valence states (not just the core states). e.g.,</p>
<div class="fragment"><div class="line">Spectrum{</div>
<div class="line">  number = 90;</div>
<div class="line">  order = 9;</div>
<div class="line">  r0_eps = 1.0e-3;</div>
<div class="line">  rmax = 90.0;</div>
<div class="line">  states = 80spd;</div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h1>MBPT: second-order correlations <a class="anchor" id="secondorder"></a></h1>
<p class="formulaDsp">
\[
  H = \sum_i h_{\rm HF}(\vec{r_i}) + \delta V_{\rm corr},
\]
</p>
<p>where \(h_{\rm HF}(\vec{r}_i)\) is the single-particle HF Hamiltonian, and</p>
<p class="formulaDsp">
\[
  \delta V_{\rm corr} = \sum_{i &lt; j}\frac{1}{r_{ij}} - \sum_i V_{\rm HF}(\vec{r_i})
\]
</p>
<p class="formulaDsp">
\[
  \delta \varepsilon_v =
  \sum_{amn}
    \frac{g_{vamn}\widetilde g_{nmav}}{\varepsilon_v+\varepsilon_a - \varepsilon_m-\varepsilon_n}
  +\sum_{abn}
    \frac{g_{vnab}\widetilde g_{banv}}{\varepsilon_v+\varepsilon_n-\varepsilon_a-\varepsilon_b}  ,
\]
</p>
<p>We define <em>correlation potential</em>, \(\Sigma\):</p>
<p class="formulaDsp">
\[
  \delta \varepsilon_v =\langle v | \Sigma |v \rangle
\]
</p>
<p>We then solve the Hartree-Fock equation, including the correlation potential. The solutions are known as <em>Brueckner orbitals</em>, and include correlation corrections.</p>
<p class="formulaDsp">
\[
  [h_{\rm HF} +  \Sigma(\varepsilon)]\phi^{\rm Br} = \varepsilon^{\rm Br}\phi^{\rm Br}
\]
</p>
<p>There are quite a few options available for Correlation corrections (see <code>ampsci -a Correlations</code>) &ndash; we will focus on the most important here.</p>
<div class="fragment"><div class="line">Correlations{</div>
<div class="line">  n_min_core = 3;</div>
<div class="line">  read;</div>
<div class="line">  write;</div>
<div class="line">  each_valence = <span class="keyword">true</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The <code>read</code> and <code>write</code> option are filenames the correlation potential will be written to and/or read from (this saves time). If none are given, it will read/write from the default filename. Set to 'false' to not read/write.</p>
<p><code>n_min_core</code> is minimum n for core states to include in polarisation loops. Very low core states contribute very little (due to large excitation energy), so this saves much time for almost no degradation in results.</p>
<p>If <code>each_valence</code> is true, a new correlation potential will be calculated for each valence state, fully taking energy dependence into account; if false, only 1 \(\Sigma\) for \(\kappa\) will be formed (i.e. assumes the same energy for calculating \(\Sigma\) for each angular symmetry).</p>
<div class="fragment"><div class="line">Correlations{</div>
<div class="line">  <span class="comment">// .... above options</span></div>
<div class="line">  fitTo_cm;</div>
<div class="line">  lambda_kappa;</div>
<div class="line">}</div>
</div><!-- fragment --><p><code>fitTo_cm</code> takes a list of experimental energies (in \({\rm cm}^{-1}\)). A scaling factor \(\lambda\) will be introduced in front of the correlation potential, and will be tuned so that energies exactly match those given. This is a semi-empirical method for accounting for higher-order correlations in wavefunctions. <code>lambda_kappa</code> is for manually setting the scaling factors. Note that for both of these, the input list must be in the exact same order as the valence states - check the 'valence' output.</p>
<h2>Excplicit energy dependence</h2>
<div class="fragment"><div class="line">Correlations{</div>
<div class="line">  <span class="comment">// .... above options</span></div>
<div class="line">  <span class="comment">// Block: Explicit list of energies to solve for. e.g., ek{6s+=-0.127;</span></div>
<div class="line">  <span class="comment">// 7s+=-0.552;}. Blank =&gt; HF energies. Takes precedence over each_valence.</span></div>
<div class="line">  <span class="comment">// [blank]</span></div>
<div class="line">  ek{}</div>
<div class="line">}</div>
</div><!-- fragment --><p>Will form the correlation potential \(\Sigma(\varepsilon)\) for the listed states at the given energy \(\varepsilon\).</p>
<div class="fragment"><div class="line">Correlations{</div>
<div class="line">  <span class="comment">// .... above options</span></div>
<div class="line">  <span class="comment">// Block: Explicit list of energies to solve for. e.g., ek{6s+=-0.127;</span></div>
<div class="line">  <span class="comment">// 7s+=-0.552;}. Blank =&gt; HF energies. Takes precidence over each_valence.</span></div>
<div class="line">  <span class="comment">// [blank]</span></div>
<div class="line">  ek{</div>
<div class="line">    6s+=-0.127;</div>
<div class="line">    6p-=-0.127;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Will use the correlation potential for \(\kappa=-1\) and \(\varepsilon = -0.127\) for the \(6s\) state, and \(\kappa=+1\) and \(\varepsilon = -0.127\) for the \(6p_{1/2}\) state.</p>
<hr  />
<h1>MBPT: all-order correlations <a class="anchor" id="allorders"></a></h1>
<p>The most important corrections beyond the second-order correlation potential are the screening of the residual Coulomb interaction by the core electrons and hole-particle interaction. These are taken into account using the <em>all-orders correlation potential method</em>, also called Perturbation Theory in the Screened Coulomb Interaction (PTSCI), developed by Dzuba, Flambaum and Sushkov [1-3].</p>
<ol type="1">
<li>V. A. Dzuba, V. V. Flambaum, P. G. Silvestrov, and O. P. Sushkov, <a href="https://dx.doi.org/10.1016/0375-9601(88)90302-7">Phys. Lett. A 131, 461 (1988).</a></li>
<li>V. A. Dzuba, V. V. Flambaum, A. Y. Kraftmakher, and O. P. Sushkov, <a href="https://dx.doi.org/10.1016/0375-9601(89)90385-X">Phys. Lett. A 142, 373 (1989).</a></li>
<li>V. A. Dzuba, V. V. Flambaum, and O. P. Sushkov, <a href="https://dx.doi.org/10.1016/0375-9601(89)90129-1">Phys. Lett. A 140, 493 (1989).</a></li>
</ol>
<p>The starting point uses the Feynman technique, in which the direct part of the correlation potential can be expressed</p>
<p class="formulaDsp">
\[
  \Sigma_{\rm d} = \int\frac{{\rm d}\omega}{2\pi} G_{12}(\varepsilon+\omega) Q_{1i}\Pi_{ij}(\omega) Q_{j2}(\omega),
\]
</p>
<p>where \(G_{12} = G(r_1,r_2)\) in the Hartee-Fock Feynman Green's function, \(Q\) is the (non-relativistic) Coulomb operator, and \(\Pi\) is the polarisation operator (subscripts are coordinate indices; integration is assumed over internal \(i\) and \(j\)). Note that \(\Pi\) represents polarisation of the atomic core.</p>
<p>The screening of the coulomb interaction can be represented by a series of polarisation corrections</p>
<p class="formulaDsp">
\[
  \widetilde Q \equiv  Q + \ Q(-i\, \Pi  Q) +  Q(-i\, \Pi  Q)^2+\ldots
\]
</p>
<p>which can be summed exactly:</p>
<p class="formulaDsp">
\[
  \widetilde Q(\omega) = Q\left[1+i\,\Pi(\omega) Q\right]^{-1}.
\]
</p>
<p>The screening is accounted for in the direct diagrams via \(Q\to \widetilde Q\) for <em>one</em> of the Coulomb operators in \(\Sigma_{\rm d}\). (Screening for exchange diagrams is taken into account in a simpler fasion, see pdf for details).</p>
<p>The hole-particle interaction arises due to the deviation of the Hartree-Fock potential for the excited core electron in the polarisation loop from that for the non-excited one. The potential that simultaneously describes the occupied core and excited states is  </p><p class="formulaDsp">
\[
  \hat V = V^{N-1} - (1-\hat P_{\rm core})V_{\rm self} (1-\hat P_{\rm core}),
\]
</p>
<p> where \(P_{\rm core}\) is the operator of projection onto the core, and \(V_{\rm self}\) is the self-interaction part of the Hartree-Fock potential for the outgoing electron. Therefore, hole-particle interaction is accounted for by using this potential when forming the polarisation operator.</p>
<p>To include all-orders correlations, the <code>Feynman</code>, <code>screening</code>, and <code>holeParticle</code> options in the <code>Correlations{}</code> block should be set to <code>true</code>. Alternativel, just set <code>AllOrder=true;</code></p>
<div class="fragment"><div class="line">Correlations{</div>
<div class="line">  n_min_core = 3;</div>
<div class="line">  each_valence = <span class="keyword">true</span>;</div>
<div class="line">  Feynman = <span class="keyword">true</span>;</div>
<div class="line">  screening = <span class="keyword">true</span>;</div>
<div class="line">  holeParticle = <span class="keyword">true</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>equivilant to:</p>
<div class="fragment"><div class="line">Correlations{</div>
<div class="line">  n_min_core = 3;</div>
<div class="line">  each_valence = <span class="keyword">true</span>;</div>
<div class="line">  AllOrder = <span class="keyword">true</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>More options are available, though they rarely need to be changed from the default. See <a href="https://ampsci.dev/ampsci.pdf">ampsci.pdf</a> for full details.</p>
<p>Note: currently, there is a numerical problem in calculating polarisation loop for very deep core states. This leads to no issues, unless you attempt to polarise a deep core shell, where large numerical errors are encountered. Best to set <code>n_min_core = 2</code> for Rb, <code>n_min_core = 3</code> for Cs, <code>n_min_core = 4</code> for Fr etc. The effect of this is negligable, as can be checked by seeing impact on second-order results. This should be addressed soon.</p>
<p>Note also: it is currently not possible to correctly account for Breit Hamiltonian within the all-orders method (problem is in construction of Green's function). Therefore, Breit should only be included at second-order level.</p>
<hr  />
<h1>MBPT for matrix elements: Core Polarisation/RPA <a class="anchor" id="rpa"></a></h1>
<p>Core polarisation (RPA) is included in the matrix elements.</p>
<p>The best method to use is TDHF, which is numerically stable, and includes contribution from negative energy states automatically.</p>
<hr  />
<h1>MBPT for matrix elements: Structure Radiation <a class="anchor" id="sructrad"></a></h1>
<p>To improve tha accuracy of matrix elements, structure radiation and normalisation corrections should be included. There is an option to do this in the MatrixElements module. There is also a <code>Module::StructureRad</code> module, which gives some finer control.</p>
<div class="fragment"><div class="line"><span class="comment">// Available Module::matrixElements options/blocks</span></div>
<div class="line"><a class="code hl_function" href="namespaceModule.html#aad4d284d8f72582faa35e991c685c9b5">Module::matrixElements</a>{</div>
<div class="line">  <span class="comment">//.... same as before</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Options for Structure Radiation and normalisation (details below)</span></div>
<div class="line">  StructureRadiation{}</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// Available StructureRadiation options/blocks</span></div>
<div class="line">StructureRadiation{</div>
<div class="line">  <span class="comment">// If this block is included, SR + Normalisation corrections will be included</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// filename for QkTable file. If blank will not use QkTable; if exists, will</span></div>
<div class="line">  <span class="comment">// read it in; if doesn&#39;t exist, will create it and write to disk. Save time</span></div>
<div class="line">  <span class="comment">// (10x) at cost of memory. Note: Using QkTable implies splines used for</span></div>
<div class="line">  <span class="comment">// diagram legs</span></div>
<div class="line">  Qk_file;</div>
<div class="line">  <span class="comment">// list; min,max n for core/excited: [1,inf]</span></div>
<div class="line">  n_minmax;</div>
<div class="line">}</div>
<div class="ttc" id="anamespaceModule_html_aad4d284d8f72582faa35e991c685c9b5"><div class="ttname"><a href="namespaceModule.html#aad4d284d8f72582faa35e991c685c9b5">Module::matrixElements</a></div><div class="ttdeci">void matrixElements(const IO::InputBlock &amp;input, const Wavefunction &amp;wf)</div><div class="ttdoc">Calculates matrix elements of any tensor operator, with RPA.</div><div class="ttdef"><b>Definition</b> matrixElements.cpp:31</div></div>
</div><!-- fragment --><p>If a Qk filename is given, program will first calculate all required Q^k Coulomb integrals before calculating structure radiation. This speeds up the calculation, at a great memory cost. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Jun 27 2025 01:28:43 for ampsci by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
